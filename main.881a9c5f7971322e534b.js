!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function urlLit(w,v){var tr='a b v g d e ["zh","j"] z i y k l m n o p r s t u f h c ch sh ["shh","shch"] ~ y ~ e yu ya ~ ["jo","e"]'.split(" "),ww="";w=w.toLowerCase();for(var i=0;i<w.length;++i){var cc=w.charCodeAt(i),ch=cc>=1072?tr[cc-1072]:w[i];ch.length<3?ww+=ch:ww+=eval(ch)[v]}return ww.replace(/[^a-zA-Z0-9\-]/g,"-").replace(/[-]{2,}/gim,"-").replace(/^\-+/g,"").replace(/\-+$/g,"")}function getWeekDay(e){for(var t=["SUN","MON","TUE","WED","THU","FRI","SAT"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=(e=e||new Date).getDay(),r=n[o],i=n.indexOf(r),a=[],c=i;c<=n.length-1;c++)a.push(t[c]);for(var u=0;u<i;u++)a.push(t[u]);return[n[o],a]}function historySearch(e,t){console.log(e);var n=t.includes(e);console.log(n,"res")}function autocomplete(e,t){var n;function o(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),n>=e.length&&(n=0),n<0&&(n=e.length-1),e[n].classList.add("autocomplete-active")}function r(t){for(var n=document.getElementsByClassName("autocomplete-items"),o=0;o<n.length;o++)t!=n[o]&&t!=e&&n[o].parentNode.removeChild(n[o])}e.addEventListener("input",(function(o){var i,a,c,u=this.value;if(r(),!u)return!1;for(n=-1,(i=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),i.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(i),c=0;c<t.length;c++)t[c].substr(0,u.length).toUpperCase()==u.toUpperCase()&&((a=document.createElement("DIV")).innerHTML="<strong>"+t[c].substr(0,u.length)+"</strong>",a.innerHTML+=t[c].substr(u.length),a.innerHTML+="<input type='hidden' value='"+t[c]+"'>",a.addEventListener("click",(function(t){e.value=this.getElementsByTagName("input")[0].value,r()})),i.appendChild(a))})),e.addEventListener("keydown",(function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(n++,o(t)):38==e.keyCode?(n--,o(t)):13==e.keyCode&&(e.preventDefault(),n>-1&&t&&t[n].click())})),document.addEventListener("click",(function(e){r(e.target)}))}__webpack_require__.d(__webpack_exports__,"b",(function(){return urlLit})),__webpack_require__.d(__webpack_exports__,"a",(function(){return getWeekDay}))},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(1);var o=document.querySelectorAll(".box-item__day"),r=document.querySelectorAll(".box-item__icon"),i=document.querySelectorAll(".box-item__temp"),a=document.querySelector(".box-item__wind"),c=document.querySelector(".info__city"),u=document.querySelector(".info__time"),s=document.querySelector(".box-big__image"),l=document.querySelector(".popup__history"),f={weatherDays:o,weatherIcons:r,weatherTemp:i,weatherWind:a,weatherBackImg:s},p={city:c,cityTime:u},h=document.querySelector(".box-big__form"),d=document.querySelector("#lastLocation"),y=document.querySelector("#submitSearchHistory"),m=document.querySelector("#historyForm");function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t}var t,n,o;return t=e,(n=[{key:"getWeatherCity",value:function(e){return fetch("https://api.openweathermap.org/data/2.5/weather?q=".concat(e,"&units=metric&appid=").concat(this.options.key,"&lang=ru")).then((function(e){return e.ok?e.json():Promise.reject("Что то пошло не так ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"getGeoCity",value:function(e,t){var n={lat:e,lon:t};return fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/geolocate/address",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token "+this.options.geoKey},body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Что то пошло не так ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"getGeoWeather",value:function(e,t){return fetch("https://api.openweathermap.org/data/2.5/onecall?lat=".concat(e,"&lon=").concat(t,"&units=metric&lang=RU&exclude=hourly,minutely&appid=").concat(this.options.key)).then((function(e){return e.ok?e.json():Promise.reject("Что то пошло не так ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"getPhoto",value:function(e){return fetch("https://pixabay.com/api/?key=".concat(this.options.imageKey,"&q=").concat(e,"&image_type=photo")).then((function(e){return e.ok?e.json():Promise.reject("Что то пошло не так ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"getTime",value:function(e){return console.log(e),fetch("http://worldtimeapi.org/api/timezone/".concat(e.timezone)).then((function(e){return e.ok?e.json():Promise.reject("Что то пошло не так ".concat(e.status))})).catch((function(e){console.log(e)}))}}])&&b(t.prototype,n),o&&b(t,o),e}(),v=n(0);function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){function e(t,n,o,r,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,"changeInfoForFormApi",(function(e){console.log(e,"value"),a.api.getWeatherCity(e).then((function(e){console.log(e,"data"),a.changeInfoOnForm(e)}))})),w(this,"changeInfoOnForm",(function(e){a.timeObj.city=Object(v.b)(e.name),a.objCity.city.textContent=e.name,console.log("Пришедший город с getWeatherCity",e),a.searchHistory.push(e.name),a.getGeoFullInfo(e.coord.lat,e.coord.lon),console.log("История",a.searchHistory)})),this.objWeather=t,this.objCity=n,this.api=o,this.geoOptions=r,this.form=i,this.timeObj={timezone:"",city:""},this.searchHistory=[]}var t,n,o;return t=e,(n=[{key:"initWeather",value:function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){e.getGeoFullInfo(t.coords.latitude,t.coords.longitude),console.log(t)}),(function(e){console.error(e)}))}},{key:"getGeoFullInfo",value:function(e,t){var n=this,o=[this.api.getGeoWeather(e,t).then((function(e){console.log("Все данные о погоде в этом городе",e),n.changeWeatherInfo(e)}),(function(e){console.log(e)})),this.api.getGeoCity(e,t).then((function(e){console.log("Геоданные",e),n.changeCity(e)}),(function(e){console.log(e)}))];Promise.allSettled(o).then((function(){try{n.changeTime(),n.changeImage()}catch(e){console.log(e)}}))}},{key:"changeWeatherInfo",value:function(e){this.timeObj.timezone=e.timezone;var t=Array.from(this.objWeather.weatherIcons),n=Array.from(this.objWeather.weatherTemp),o=Array.from(this.objWeather.weatherDays),r=this.objWeather.weatherWind,i=new Date,a=Object(v.a)(i);r.textContent=e.current.wind_speed+" mph";for(var c=0;c<=t.length;c++)n[c].textContent=Math.floor(e.daily[c].temp.day),0===c?(t[c].src="http://openweathermap.org/img/wn/".concat(e.daily[c].weather[0].icon,"@4x.png"),o[c].textContent=a[c]):(t[c].src="http://openweathermap.org/img/wn/".concat(e.daily[c].weather[0].icon,"@2x.png"),o[c].textContent=a[1][c])}},{key:"changeCity",value:function(e){console.log("Город",e);var t=this.objCity.city.textContent=e.suggestions[0].data.city;this.objCity.city.textContent=t,this.timeObj.city=Object(v.b)(t)}},{key:"changeTime",value:function(){var e=this;this.api.getTime(this.timeObj).then((function(t){var n=t.datetime.split("T")[1].split(".")[0].slice(0,5);e.objCity.cityTime.textContent=n})).catch((function(e){console.log(e)}))}},{key:"changeImage",value:function(){var e=this;this.api.getPhoto(this.timeObj.city).then((function(t){if(void 0!==t){console.log(t);var n=t.hits.length,o=Math.floor(Math.random()*(n-0)+0),r=t.hits[o].largeImageURL;e.objWeather.weatherBackImg.src=r}})).catch((function(e){console.log(e)}))}},{key:"initSearchForm",value:function(){var e=this;this.form.addEventListener("submit",(function(t){t.preventDefault();var n=t.target.searchValue.value;e.changeInfoForFormApi(n),t.target.reset()}))}}])&&_(t.prototype,n),o&&_(t,o),e}();function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=E(e);if(t){var r=E(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return L(this,n)}}function L(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?x(e):t}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(i,e);var t,n,o,r=O(i);function i(e,t,n,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),A(x(a=r.call(this,e)),"_removeDisable",(function(e,t,n,o){e.removeAttribute("disabled"),t.removeAttribute("disabled"),n.removeAttribute("disabled"),o.removeAttribute("disabled")})),A(x(a),"_removeEnabled",(function(e,t,n,o){e.setAttribute("disabled",!0),t.setAttribute("disabled",!0),n.setAttribute("disabled",!0),o.setAttribute("disabled",!0)})),a.mainApi=t,a.searchHistory=n,a.changeInfoForFormApi=o,a}return t=i,(n=[{key:"initHistoryForm",value:function(){var e=this,t=this.containerPopup.querySelector("#historyForm");this.containerPopup,t.addEventListener("submit",(function(t){t.preventDefault();try{var n=t.target.historySearch.value;console.log(n,"input"),e.changeInfoForFormApi(n),t.target.reset(),e._closePopup(t)}catch(t){console.log(t)}}))}}])&&S(t.prototype,n),o&&S(t,o),i}((function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j(this,"open",(function(){n.containerPopup.classList.add("popup_is_opened"),n._addListenerClose(n.containerPopup)})),j(this,"close",(function(e){e.target.classList.contains("popup__close")&&n._closePopup(e),e.target.classList.contains("popup")&&n._closePopup(e),e.target.classList.contains("popup__text_status_move")&&n._closePopup(e)})),j(this,"_closePopup",(function(e){var t=e.target.closest(".popup");n._removeListenerClose(t),t.classList.remove("popup_is_opened")})),j(this,"_addListenerClose",(function(e){e.addEventListener("click",n.close)})),j(this,"_removeListenerClose",(function(e){e.removeEventListener("click",n.close)})),j(this,"removePopup",(function(){n._removeListenerClose(n.containerPopup),n.containerPopup.classList.remove("popup_is_opened")})),this.containerPopup=t}));function I(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var F=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=t,this.button=n,this.errorMessage=o}var t,n,o;return t=e,(n=[{key:"_checkInputValidity",value:function(e,t){for(var n in this.errorMessage)if(e.validity[n])return t.textContent=this.errorMessage[n];t.textContent=""}},{key:"_setSubmitButtonState",value:function(){this.form.checkValidity()?this._buttonEnable():this._buttonDissable()}},{key:"setEventListeners",value:function(){var e=this;this.form.addEventListener("input",(function(t){e._checkInputValidity(t.target,t.target.nextElementSibling),e._setSubmitButtonState()}))}},{key:"_buttonEnable",value:function(){this.button.removeAttribute("disabled"),this.button.classList.remove("popup__button_is_disabled"),this.button.classList.add("popup__button_is_enabled")}},{key:"_buttonDissable",value:function(){this.button.setAttribute("disabled",!0),this.button.classList.add("popup__button_is_disabled"),this.button.classList.remove("popup__button_is_enabled")}}])&&I(t.prototype,n),o&&I(t,o),e}(),W=new g({key:"e7e013145e8f764392b0517c2ab23d80",imageKey:"16932497-da77038ac64e17ff9ad2c6a4e",geoKey:"0fc39a2abbc5fbc725494cf468bf07aa8f080070"}),q=new k(f,p,W,{timeout:2e3,maximumAge:1e4,enableHighAccuracy:!0},h),D=new T(l,W,q.searchHistory,q.changeInfoForFormApi),M=new F(m,y,{valueMissing:"Это обязательное поле",tooShort:"Должен быть от 4 символов",typeMismatch:"Неверный формат записи"});d.addEventListener("click",D.open),q.initWeather(),q.initSearchForm(),D.initHistoryForm(),M.setEventListeners(),window.addEventListener("keydown",(function(e){27===e.keyCode&&D.removePopup()}))}]);